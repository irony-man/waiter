{% extends "common/base.html" %}
{% load static %}

{% block content %}
  <div class="container">
    <div class="mb-5 pb-5 mx-auto" style="max-width: 400px;">
        <div class="card-shadow p-5">
          <div class="fw-bold text-center mb-5">
            <img src="{% static 'images/logo.png' %}" alt="Waiter logo" style="max-width: 120px;">
          </div>
          <form method="POST" class="form" id="form">
            <div class="form-group mb-4">
              <label for="phone_display" class="form-label">Enter Your Phone Number</label>
              <div>
                <input type="tel" name="phone_display" id="phone_display" class="form-control w-100" {% if form.phone.value %}value="{{ form.phone.value }}"{% endif %} autofocus placeholder="Enter your phone number">
                <input type="hidden" name="phone" id="phone"/>
              </div>
              {% if form.errors.phone %}
                <div class="small text-danger mt-2">{{ form.errors.phone|join:' ' }}</div>
              {% endif %}
            </div>
            {% if form.errors.all %}
              <div class="alert alert-danger mt-2">{{ form.errors.all|join:' ' }}</div>
            {% endif %}
            <div class="text-end mb-5">
              {% csrf_token %}
              <button class="btn btn-primary btn-icon w-100">
                <i class="fas fa-lock"></i> Login
              </button>
            </div>
          </form>
        </div>
    </div>
  </div>
{% endblock content %}

{% block script %}
  <script>
    var input = document.querySelector("#phone_display");
    const iti = window.intlTelInput(input, {
      utilsScript: "{% static 'telinput/utils.js' %}",
      initialCountry: "IN",
      preferredCountries: ["IN", "US"],
      formatOnDisplay: true,
      separateDialCode: true,
    });

    setTimeout(function() { input.focus(); }, 100);

    const form = document.getElementById("form");
    form.addEventListener("submit", function(e) {
      e.preventDefault();
      document.getElementById("phone").value = iti.getNumber(intlTelInputUtils.numberFormat.E164);
      e.target.submit();
    });
  </script>
{% endblock script %}
